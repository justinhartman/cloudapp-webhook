#!/usr/bin/env bash
#
# Setup the media folders and SQLite database from repo.
#
# Author: Justin Hartman <j.hartman@ctca.co.za>
# Version: 1.0.0
# Copyright (c) 2020 Creative Academy <https://creativeacademy.ac.za>
#

#######################################
# Setup the Python repo.
# Globals:
#   None
# Arguments:
#   None
# Returns:
#   None
#######################################
python_setup() {
    echo "游릭 Cleaning up old files..."
    rm .gitignore
    echo "游릭 Setting up the local git repository..."
    git init
    git remote add origin https://"${GITHUB_USERNAME}":"${GITHUB_WRITE_REPO}"@github.com/thecreativeacademy/heroku-media.git
    echo "游릭 Pulling latest files from heroku-media git repo..."
    git pull -f origin master
    echo "游릭 Fetching latest tags from heroku-media git repo..."
    git fetch --tags
}

#######################################
# Cleanup Python files not needed.
# Globals:
#   None
# Arguments:
#   None
# Returns:
#   None
#######################################
python_cleanup() {
    echo "游릭 Performing cleanup on server..."
    rm .config/create.sql
    rm .editorconfig
    rm Aptfile
    rm Pipfile
    rm Pipfile.lock
    rm README.md
    rm requirements.txt
    rm runtime.txt
}

#######################################
# Setup the repo.
# Globals:
#   None
# Arguments:
#   None
# Returns:
#   None
#######################################
git_setup () {
    echo "游릭 Setting up the local git repository..."
    rm .gitignore
    git init
    git remote add origin https://"${GITHUB_USERNAME}":"${GITHUB_WRITE_REPO}"@github.com/thecreativeacademy/heroku-media.git
    git lfs track "*.mov"
    git lfs track "*.mp4"
    git config --global user.name "Automated Bot"
    git config --global user.email "j.hartman@ctca.co.za"
    git pull -f origin master
    git fetch --tags
}

#######################################
# Cleanup files not needed.
# Globals:
#   None
# Arguments:
#   None
# Returns:
#   None
#######################################
cleanup() {
    echo "游릭 Performing cleanup on server..."
    rm .config/create.sql
    rm README.md
}

# Run the application thread.
# git_setup
# cleanup
python_setup
python_cleanup
exit 0
